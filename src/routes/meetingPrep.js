import express from 'express';
import meetingPrepService from '../services/meetingPrepService.js';
import { validateMeetingPrepRequest } from '../middleware/validation.js';

const router = express.Router();

/**
 * 1:1 ë¯¸íŒ… í”„ë ™íŒ© ìƒì„±
 * POST /api/meeting-prep/generate
 */
router.post('/generate', validateMeetingPrepRequest, async (req, res) => {
  try {
    console.log('ğŸ¯ ë¯¸íŒ… í”„ë ™íŒ© ìƒì„± ìš”ì²­:', req.body.teamMember.name);
    console.log('ğŸ“Š íŒ€ì› ì„±í–¥:', req.body.teamMember.tendencies);
    console.log('ğŸ¯ ë¦¬ë” ì˜ë„:', req.body.meetingInfo?.leaderIntention);
    console.log('â° ë¯¸íŒ… ì¼ì‹œ:', req.body.meetingInfo?.meetingDateTime);
    
    const meetingPrep = await meetingPrepService.generateMeetingPrep(req.body.teamMember, req.body.meetingInfo);
    
    console.log('âœ… ë¯¸íŒ… í”„ë ™íŒ© ìƒì„± ì™„ë£Œ:', meetingPrep.id);
    
    res.json({
      success: true,
      data: meetingPrep,
      message: 'ë¯¸íŒ… í”„ë ™íŒ©ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤'
    });
  } catch (error) {
    console.error('âŒ ë¯¸íŒ… í”„ë ™íŒ© ìƒì„± ì‹¤íŒ¨:', error);
    res.status(500).json({
      success: false,
      error: error.message || 'ë¯¸íŒ… í”„ë ™íŒ© ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤'
    });
  }
});

/**
 * ë¯¸íŒ… í”„ë ™íŒ© í…œí”Œë¦¿ ì¡°íšŒ
 * GET /api/meeting-prep/templates
 */
router.get('/templates', (req, res) => {
  const templates = {
    questionTemplates: {
      situationAwareness: [
        "ìµœê·¼ ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸ì—ì„œ ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ë¶€ë¶„ì€ ë¬´ì—‡ì¸ê°€ìš”?",
        "ì´ë²ˆ ì£¼ ì—…ë¬´ì—ì„œ ê°€ì¥ í° ì„±ì·¨ê°ì„ ëŠë‚€ ìˆœê°„ì€ ì–¸ì œì˜€ë‚˜ìš”?",
        "í˜„ì¬ ì—…ë¬´ì—ì„œ ê°€ì¥ ë„ì „ì ì¸ ë¶€ë¶„ì€ ë¬´ì—‡ì¸ê°€ìš”?",
        "ìµœê·¼ íŒ€ ë‚´ì—ì„œ ì¼ì–´ë‚œ ë³€í™” ì¤‘ ì£¼ëª©í•  ë§Œí•œ ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?"
      ],
      growthSupport: [
        "í˜„ì¬ ì—­ëŸ‰ ê°œë°œì—ì„œ ì§‘ì¤‘í•˜ê³  ì‹¶ì€ ì˜ì—­ì´ ìˆë‚˜ìš”?",
        "ì—…ë¬´ ìˆ˜í–‰ ì¤‘ ê°€ì¥ ë„ì›€ì´ í•„ìš”í•œ ë¶€ë¶„ì€ ë¬´ì—‡ì¸ê°€ìš”?",
        "6ê°œì›” í›„ ì–´ë–¤ ëª¨ìŠµì´ ë˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?",
        "ì–´ë–¤ ìƒˆë¡œìš´ ìŠ¤í‚¬ì´ë‚˜ ì§€ì‹ì„ ë°°ìš°ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?",
        "í˜„ì¬ ì—…ë¬´ì—ì„œ ë” ë°œì „ì‹œí‚¤ê³  ì‹¶ì€ ë¶€ë¶„ì€ ë¬´ì—‡ì¸ê°€ìš”?"
      ],
      motivation: [
        "íŒ€ì—ì„œ ê°€ì¹˜ ìˆë‹¤ê³  ëŠë¼ëŠ” í™œë™ì€ ë¬´ì—‡ì¸ê°€ìš”?",
        "ì–´ë–¤ ìƒí™©ì—ì„œ ê°€ì¥ ë§ì€ ì—ë„ˆì§€ë¥¼ ì–»ë‚˜ìš”?",
        "ì—…ë¬´ì—ì„œ ê°€ì¥ ë§Œì¡±ìŠ¤ëŸ¬ìš´ ìˆœê°„ì€ ì–¸ì œì¸ê°€ìš”?",
        "íŒ€ì˜ ëª©í‘œ ë‹¬ì„±ì— ê¸°ì—¬í•˜ê³  ìˆë‹¤ê³  ëŠë¼ëŠ” ë¶€ë¶„ì€ ë¬´ì—‡ì¸ê°€ìš”?"
      ]
    },
    encouragementTemplates: [
      "~~ë‹˜ì˜ [êµ¬ì²´ì ì¸ í–‰ë™]ì´ íŒ€ì— í° ì˜í–¥ì„ ì£¼ê³  ìˆì–´ìš”. íŠ¹íˆ [êµ¬ì²´ì ì¸ ê²°ê³¼]ì—ì„œ ê·¸ ê°€ì¹˜ê°€ ì˜ ë“œëŸ¬ë‚©ë‹ˆë‹¤.",
      "ìµœê·¼ [ìƒí™©]ì—ì„œ ë³´ì—¬ì¤€ [ì—­ëŸ‰/íƒœë„]ì´ ì •ë§ ì¸ìƒì ì´ì—ˆìŠµë‹ˆë‹¤. ì´ëŸ° ì ‘ê·¼ì´ ~~ë‹˜ì˜ ì„±ì¥ë¿ë§Œ ì•„ë‹ˆë¼ íŒ€ ì „ì²´ì—ë„ ê¸ì •ì ì¸ ì˜í–¥ì„ ì¤ë‹ˆë‹¤.",
      "~~ë‹˜ì´ ê°€ì§„ [ê°•ì ]ì€ ìš°ë¦¬ íŒ€ì—ê²Œ ë§¤ìš° ì†Œì¤‘í•œ ìì‚°ì´ì—ìš”. ì´ë¥¼ ë”ìš± ë°œì „ì‹œí‚¬ ìˆ˜ ìˆëŠ” ê¸°íšŒë¥¼ ì°¾ì•„ë³´ê² ìŠµë‹ˆë‹¤.",
      "ê¾¸ì¤€í•œ ë…¸ë ¥ê³¼ ê¸ì •ì ì¸ íƒœë„ê°€ íŒ€ ì „ì²´ì˜ ë¶„ìœ„ê¸°ë¥¼ ë°ê²Œ ë§Œë“¤ì–´ì£¼ê³  ìˆìŠµë‹ˆë‹¤.",
      "ìµœê·¼ ë³´ì—¬ì£¼ì‹  [êµ¬ì²´ì ì¸ ì„±ê³¼]ëŠ” ì •ë§ í›Œë¥­í•©ë‹ˆë‹¤. ì´ëŸ° ì„±ì¥ì„¸ë¥¼ ìœ ì§€í•˜ì‹œë©´ ë” í° ì„±ê³¼ë¥¼ ê±°ë‘ì‹¤ ìˆ˜ ìˆì„ ê²ƒ ê°™ì•„ìš”."
    ],
    meetingGuidelines: {
      opening: [
        "ë”°ëœ»í•œ ì¸ì‚¬ì™€ ìµœê·¼ ê·¼í™© ë¬¼ì–´ë³´ê¸°",
        "ì´ë²ˆ ë¯¸íŒ…ì˜ ëª©ì ê³¼ ê¸°ëŒ€íš¨ê³¼ ê³µìœ ",
        "í¸ì•ˆí•œ ë¶„ìœ„ê¸° ì¡°ì„±",
        "íŒ€ì›ì˜ í˜„ì¬ ìƒíƒœì™€ ê´€ì‹¬ì‚¬ íŒŒì•…"
      ],
      during: [
        "ì ê·¹ì ì¸ ê²½ì²­ê³¼ ê³µê° í‘œí˜„",
        "êµ¬ì²´ì ì¸ ì˜ˆì‹œë¥¼ í†µí•œ í”¼ë“œë°±",
        "ì„±ì¥ ì§€í–¥ì  ì§ˆë¬¸ í™œìš©",
        "íŒ€ì›ì˜ ì˜ê²¬ì„ ì¡´ì¤‘í•˜ê³  ê²©ë ¤",
        "ëª…í™•í•˜ê³  ê±´ì„¤ì ì¸ í”¼ë“œë°± ì œê³µ"
      ],
      closing: [
        "ë‹¤ìŒ ë‹¨ê³„ì™€ í›„ì† ì¡°ì¹˜ ëª…í™•íˆ í•˜ê¸°",
        "ì§€ì†ì ì¸ ì§€ì› ì˜ì§€ í‘œí˜„",
        "ë‹¤ìŒ ë¯¸íŒ… ì¼ì • ì¡°ìœ¨",
        "ë¯¸íŒ… ë‚´ìš© ìš”ì•½ ë° í™•ì¸"
      ]
    }
  };

  res.json({
    success: true,
    data: templates
  });
});

/**
 * ë¯¸íŒ… í”„ë ™íŒ© íˆìŠ¤í† ë¦¬ ì¡°íšŒ (ê°„ë‹¨í•œ ë©”ëª¨ë¦¬ ê¸°ë°˜)
 * GET /api/meeting-prep/history
 */
router.get('/history', (req, res) => {
  // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒ
  const mockHistory = [
    {
      id: '1',
      teamMember: 'ê¹€ì² ìˆ˜',
      generatedAt: '2024-01-15 14:30:00',
      status: 'completed'
    },
    {
      id: '2', 
      teamMember: 'ì´ì˜í¬',
      generatedAt: '2024-01-14 10:15:00',
      status: 'in_progress'
    }
  ];

  res.json({
    success: true,
    data: mockHistory
  });
});

export default router;
